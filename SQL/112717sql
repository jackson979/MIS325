/*
SET SERVEROUTPUT ON;

DECLARE 
    sum_balance_due_var NUMBER(9, 2);
BEGIN
    SELECT SUM(invoice_total -payment_total -credit_total)
    INTO sum_balance_due_var
    FROM invoices 
    WHERE vendor_id = 95;
    IF sum_balance_due_var > 0 THEN
        DBMS_OUTPUT.PUT_LINE('Balance due: $' || 
                            ROUND(sum_balance_due_var, 2));
    ELSE
        DBMS_OUTPUT.PUT_LINE('Balance paid in full');
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('An error occurred');
END;


SET SERVEROUTPUT ON;

DECLARE
    max_invoice_total  invoices.invoice_total%TYPE;
    min_invoice_total  invoices.invoice_total%TYPE;
    percent_difference NUMBER;
    count_invoice_id   NUMBER;
    vendor_id_var     NUMBER := 95;
BEGIN
    SELECT MAX(invoice_total), MIN(invoice_total), COUNT(invoice_id)
    INTO max_invoice_total, min_invoice_total, count_invoice_id
    FROM invoices 
    WHERE vendor_id = vendor_id_var;
    percent_difference :=
        (max_invoice_total - min_invoice_total) / min_invoice_total * 100;
    DBMS_OUTPUT.PUT_LINE('Maximum invoice: $' ||
                            max_invoice_total);
    DBMS_OUTPUT.PUT_LINE('Minimum invoice: $' ||
                            min_invoice_total);
    DBMS_OUTPUT.PUT_LINE('Percent difference: %' ||
                            ROUND(percent_difference, 2));  
    DBMS_OUTPUT.PUT_LINE('Number of invoices: ' ||     
                            count_invoice_id);
END;


--Exercise 1
SET SERVEROUTPUT ON;

DECLARE 
    count_inv NUMBER;
BEGIN
    SELECT COUNT(*)
    INTO count_inv
    FROM invoices
    WHERE invoice_total - payment_total - credit_total >= 5000;
    
    DBMS_OUTPUT.PUT_LINE(count_inv || ' invoices exceed $5,000.');
END;
*/

--EXERCISE 2
SET SERVEROUTPUT ON;

DECLARE 
    count_inv NUMBER; 
    sum_balances invoices.invoice_total%TYPE;
BEGIN
    SELECT COUNT(*),SUM(invoice_total - payment_total - credit_total)
    INTO count_inv,sum_balances
    FROM invoices
    WHERE (invoice_total - payment_total - credit_total) > 0;
    
    IF sum_balances >= 50000 THEN
        DBMS_OUTPUT.PUT_LINE('Number of unpaid invoices is ' || count_inv || '.');
        DBMS_OUTPUT.PUT_LINE('Total balance due is $' || sum_balances || '.');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Total balance due is less than $50,000.');
    END IF;
END;